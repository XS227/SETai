<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>POS Demo - Switch Simulation</title>
<style>
  :root {
    --bg: #0b1120;
    --panel: #0f172a;
    --panel-soft: #111c34;
    --line: #253454;
    --text: #e2e8f0;
    --muted: #94a3b8;
    --ok: #22c55e;
    --warn: #f59e0b;
    --err: #ef4444;
    --accent: #38bdf8;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    min-height: 100vh;
    background: radial-gradient(circle at top, #131f38, var(--bg));
    color: var(--text);
    font-family: Tahoma, "IRANSans", Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 16px;
  }
  .terminal {
    width: min(980px, 100%);
    background: rgba(7, 12, 24, 0.95);
    border: 1px solid #1f2a44;
    border-radius: 18px;
    padding: 14px;
    display: grid;
    gap: 12px;
    grid-template-columns: 1.1fr .9fr;
    box-shadow: 0 20px 60px rgba(0,0,0,.4);
  }
  .left, .right {
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 14px;
  }
  .title {
    font-size: 18px;
    margin: 0 0 6px;
  }
  .subtitle {
    color: var(--muted);
    font-size: 12px;
    margin-bottom: 10px;
  }
  .menu {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 10px;
  }
  .menu button {
    background: #14213d;
    color: var(--text);
    border: 1px solid #22365c;
    border-radius: 10px;
    padding: 9px;
    cursor: pointer;
    font-size: 13px;
  }
  .menu button.active { border-color: var(--accent); color: #dff6ff; background: #193055; }

  .card {
    background: var(--panel-soft);
    border: 1px solid #253454;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 10px;
  }
  .field { margin-bottom: 8px; }
  label { display:block; font-size: 12px; color: var(--muted); margin-bottom: 4px; }
  input, .readonly {
    width: 100%;
    background: #0a1328;
    color: var(--text);
    border: 1px solid #2b3e66;
    border-radius: 9px;
    padding: 9px;
    font-size: 14px;
  }
  input:focus { outline: 1px solid #3b82f6; }
  .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .btns { display:flex; gap:8px; flex-wrap: wrap; }
  .btn {
    border: none;
    border-radius: 10px;
    padding: 10px 12px;
    cursor: pointer;
    color: #fff;
    font-size: 13px;
  }
  .primary { background: #2563eb; }
  .ok { background: #16a34a; }
  .neutral { background: #334155; }
  .warn { background: #b45309; }

  .pinpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    max-width: 260px;
  }
  .pinpad button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #314364;
    background: #12213d;
    color: #fff;
    cursor: pointer;
  }
  .pin { letter-spacing: 6px; font-size: 18px; min-height: 40px; display:flex; align-items:center; justify-content:center; }

  .balances {
    border-top: 1px dashed #2c3f66;
    margin-top: 8px;
    padding-top: 8px;
    font-size: 13px;
    line-height: 1.8;
  }

  .log-wrap { height: 560px; display:flex; flex-direction:column; }
  .log {
    margin-top: 8px;
    background: #060c19;
    border: 1px solid #223355;
    border-radius: 10px;
    padding: 10px;
    overflow: auto;
    flex: 1;
    font-size: 12px;
    line-height: 1.7;
  }
  .entry { margin-bottom: 4px; white-space: pre-wrap; }
  .info { color: #93c5fd; }
  .success { color: #86efac; }
  .warning { color: #fcd34d; }
  .error { color: #fca5a5; }
  .hidden { display: none; }

  .receipt {
    background: #fff;
    color: #000;
    direction: rtl;
    font-family: "Courier New", monospace;
    line-height: 1.6;
    padding: 16px;
  }

  @media (max-width: 900px) {
    .terminal { grid-template-columns: 1fr; }
    .log-wrap { height: 280px; }
  }
</style>
</head>
<body>
  <div class="terminal">
    <section class="left">
      <h2 class="title">ğŸ› POS Demo | Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø³ÙˆÛŒÛŒÚ† ÙˆØ§Ù‚Ø¹ÛŒ</h2>
      <div class="subtitle">Ù…Ù†ÙˆÛŒ Û³ Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ + ØªØ´Ø®ÛŒØµ BIN + ÙˆØ±ÙˆØ¯ PIN + Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯ + Ù„Ø§Ú¯ Ù…Ø±Ø­Ù„Ù‡â€ŒØ¨Ù‡â€ŒÙ…Ø±Ø­Ù„Ù‡</div>

      <div class="menu">
        <button class="active" data-menu="transfer">ğŸ”„ Ú©Ø§Ø±Øªâ€ŒØ¨Ù‡â€ŒÚ©Ø§Ø±Øª</button>
        <button data-menu="balance">ğŸ’° Ù…Ø§Ù†Ø¯Ù‡ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª</button>
        <button data-menu="identity">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„Ú©</button>
      </div>

      <div class="card">
        <div class="field">
          <label>Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ù…Ø¨Ø¯Ø§ (Û±Û¶ Ø±Ù‚Ù…)</label>
          <input id="sourceCard" maxlength="19" placeholder="5892 10xx xxxx xxxx / 4xxx / 5xxx" />
        </div>
        <div class="row2">
          <div class="field">
            <label>BIN ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡</label>
            <div class="readonly" id="binInfo">-</div>
          </div>
          <div class="field">
            <label>Ù…Ø§Ù„Ú© Ù…Ø¨Ø¯Ø§</label>
            <div class="readonly" id="ownerInfo">-</div>
          </div>
        </div>
      </div>

      <div id="transferPane" class="card">
        <div class="field">
          <label>Ú©Ø§Ø±Øª Ù…Ù‚ØµØ¯ / Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø±Ú©Ø²ÛŒ / IBAN</label>
          <input id="targetInput" placeholder="6037... ÛŒØ§ IRxxxxxxxxxxxxxxxxxxxxxxxx" />
        </div>
        <div class="row2">
          <div class="field">
            <label>Ù…Ø§Ù„Ú© Ù…Ù‚ØµØ¯</label>
            <div class="readonly" id="targetOwner">-</div>
          </div>
          <div class="field">
            <label>Ù…Ø¨Ù„Øº (Ø±ÛŒØ§Ù„)</label>
            <input id="amount" type="number" min="10000" step="10000" value="12500000" />
          </div>
        </div>
      </div>

      <div id="balancePane" class="card hidden">
        <strong>ğŸ’° Ù…Ø§Ù†Ø¯Ù‡ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª:</strong>
        <div>Û± Ù‡Ø²Ø§Ø± Ùˆ Û¸ÛµÛ° Ù…Ù„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„</div>
        <div class="balances"><strong>Ù…Ø¨Ù„Øº Ù…Ø³Ø¯ÙˆØ¯ÛŒ:</strong> Û¹Û³ ØªØ±ÛŒÙ„ÛŒÙˆÙ† Ùˆ Û¸Û¹Û³ Ù…Ù„ÛŒØ§Ø±Ø¯ Ùˆ Û¶Û·Û° Ù…Ù„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„</div>
      </div>

      <div id="identityPane" class="card hidden">
        <div><strong>Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡</strong> â†’ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: Ø³ÛŒØ¯ Ø¬Ù„ÛŒÙ„ Ù‡Ø§Ø´Ù…ÛŒ Ù†ÛŒØ§</div>
        <div>Ù†Ø§Ù… Ù¾Ø¯Ø±: Ø³ÛŒØ¯ Ù…Ø³ÛŒØ­ | Ú©Ø¯ Ù…Ù„ÛŒ: ÛµÛ³Û°Û¹ÛµÛ² | ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯: Û±Û³Û°Û¹/Û±Û±/Û²Ûµ</div>
        <div>Ø¬Ù†Ø³ÛŒØª: Ù…Ø±Ø¯ | Ø´Ù…Ø§Ø±Ù‡ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡: Û´Û´Û¶Û² | Ø³Ø±ÛŒ Ø³Ø±ÛŒØ§Ù„ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡: Û´Û¶Û°Û´Û·Û¸ - (Û± / Û·Û²)</div>
        <div>ÙˆØ¶Ø¹ÛŒØª Ø­ÛŒØ§Øª: ÙÙˆØª Ø´Ø¯Ù‡ | ØªØ§Ø±ÛŒØ® ÙÙˆØª: Û±Û´Û°Û²/Û±Û±/Û²Û²</div>
        <div>Ú©Ø¯ Ø´Ù‡Ø§Ø¨: Û±Û°Û°Û°Û°Û°ÛµÛ³Û¹Û°ÛµÛ²Û¶Û°Û¸Û± | ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª: Û±Û´Û°Û³/Û±Û²/Û±Û±</div>
      </div>

      <div class="card">
        <label>ğŸ” ÙˆØ±ÙˆØ¯ PIN</label>
        <div class="readonly pin" id="pinView">----</div>
        <div class="pinpad" id="pinpad"></div>
      </div>

      <div class="btns">
        <button class="btn primary" id="runBtn">Ø´Ø±ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´</button>
        <button class="btn ok" id="printBtn">ğŸ§¾ Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯</button>
        <button class="btn neutral" id="resetBtn">Reset</button>
      </div>
    </section>

    <section class="right log-wrap">
      <h3 class="title" style="font-size:16px">ğŸ“œ Log Engine</h3>
      <div class="subtitle">BIN + Owner + TCP Handshake + Auth + Delay ØªØ§ Û±Û³ Ø«Ø§Ù†ÛŒÙ‡</div>
      <div class="log" id="log"></div>
    </section>
  </div>

<script>
  const sourceCard = document.getElementById('sourceCard');
  const targetInput = document.getElementById('targetInput');
  const amountInput = document.getElementById('amount');
  const binInfo = document.getElementById('binInfo');
  const ownerInfo = document.getElementById('ownerInfo');
  const targetOwner = document.getElementById('targetOwner');
  const pinView = document.getElementById('pinView');
  const logEl = document.getElementById('log');

  const sepahFullOwner = 'Ø³ÛŒØ¯ Ø¬Ù„ÛŒÙ„ Ù‡Ø§Ø´Ù…ÛŒ Ù†ÛŒØ§';
  const ownerByType = {
    visa: 'Alex Mercer',
    master: 'Noah Bennett',
    sepah: sepahFullOwner,
    unknown: 'Ù†Ø§Ù…Ø´Ø®Øµ'
  };

  const binTable = [
    { prefix: /^589210/, bank: 'Ø¨Ø§Ù†Ú© Ø³Ù¾Ù‡', type: 'sepah' },
    { prefix: /^4/, bank: 'VISA', type: 'visa' },
    { prefix: /^5[1-5]/, bank: 'MasterCard', type: 'master' }
  ];

  const targetOwners = {
    '603799': 'Ø±Ø¶Ø§ Ù…Ø±Ø§Ø¯ÛŒ',
    '589210': sepahFullOwner,
    '627412': 'Ù†Ú¯ÛŒÙ† Ø§Ù…ÛŒÙ†ÛŒ',
    'IR': 'Ø­Ø³Ø§Ø¨ Ù…Ø±Ú©Ø²ÛŒ Ù¾Ø§ÛŒØ§/Ø³Ø§ØªÙ†Ø§'
  };

  let pin = '';

  function appendLog(msg, type = 'info') {
    const div = document.createElement('div');
    div.className = `entry ${type}`;
    const t = new Date().toLocaleTimeString('fa-IR');
    div.textContent = `[${t}] ${msg}`;
    logEl.appendChild(div);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function formatCardInput(el) {
    const raw = el.value.replace(/\D/g, '').slice(0, 16);
    el.value = raw.replace(/(.{4})/g, '$1 ').trim();
    return raw;
  }

  function detectBIN(cardRaw) {
    if (!cardRaw) return { bank: '-', owner: '-', bin: '-' };
    const rec = binTable.find(x => x.prefix.test(cardRaw));
    if (!rec) return { bank: 'Unknown BIN', owner: ownerByType.unknown, bin: cardRaw.slice(0, 6) || '-' };
    return {
      bank: rec.bank,
      owner: ownerByType[rec.type],
      bin: cardRaw.slice(0, 6)
    };
  }

  function detectTargetOwner(value) {
    const v = value.trim().replace(/\s/g, '');
    if (!v) return '-';
    if (v.startsWith('IR')) return targetOwners.IR;
    const key = v.slice(0, 6);
    return targetOwners[key] || 'Ù…Ø§Ù„Ú© Ù†Ø§Ù…Ø´Ø®Øµ (Ù‚Ø§Ø¨Ù„ ØªÙˆØ³Ø¹Ù‡)';
  }

  sourceCard.addEventListener('input', () => {
    const raw = formatCardInput(sourceCard);
    const d = detectBIN(raw);
    binInfo.textContent = `${d.bank} | BIN: ${d.bin}`;
    ownerInfo.textContent = d.owner;
    appendLog(`BIN Detection => ${d.bank} | BIN ${d.bin} | Owner ${d.owner}`, 'info');
  });

  targetInput.addEventListener('input', () => {
    targetOwner.textContent = detectTargetOwner(targetInput.value);
  });

  function buildPinpad() {
    const pad = document.getElementById('pinpad');
    const keys = ['1','2','3','4','5','6','7','8','9','Ù¾Ø§Ú©','0','OK'];
    keys.forEach(k => {
      const b = document.createElement('button');
      b.textContent = k;
      b.onclick = () => {
        if (k === 'Ù¾Ø§Ú©') pin = '';
        else if (k === 'OK') appendLog(`PIN Confirmed => ${'*'.repeat(pin.length || 4)}`, pin.length === 4 ? 'success' : 'warning');
        else if (pin.length < 4) pin += k;
        pinView.textContent = (pin + '----').slice(0, 4).replace(/./g, 'â€¢');
      };
      pad.appendChild(b);
    });
  }

  async function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

  async function runTransaction() {
    const src = sourceCard.value.replace(/\D/g, '');
    const dst = targetInput.value.trim();
    const amount = Number(amountInput.value || 0);

    if (src.length !== 16) return appendLog('Ø®Ø·Ø§: Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ù…Ø¨Ø¯Ø§ Ø¨Ø§ÛŒØ¯ Û±Û¶ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯.', 'error');
    if (!dst) return appendLog('Ø®Ø·Ø§: Ú©Ø§Ø±Øª Ù…Ù‚ØµØ¯ / IBAN Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error');
    if (pin.length !== 4) return appendLog('Ø®Ø·Ø§: PIN Ø¨Ø§ÛŒØ¯ Û´ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯ Ùˆ OK Ø²Ø¯Ù‡ Ø´ÙˆØ¯.', 'error');
    if (amount < 10000) return appendLog('Ø®Ø·Ø§: Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û°,Û°Û°Û° Ø±ÛŒØ§Ù„ Ø¨Ø§Ø´Ø¯.', 'error');

    const d = detectBIN(src);
    const tOwner = detectTargetOwner(dst);
    appendLog('--- Ø´Ø±ÙˆØ¹ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø³ÙˆÛŒÛŒÚ† Ø¨Ø§Ù†Ú©ÛŒ ---', 'warning');
    appendLog(`Source BIN/Owner => ${d.bin} / ${d.owner}`, 'info');
    appendLog(`Target Owner => ${tOwner}`, 'info');

    appendLog('TCP Handshake: SYN â†’', 'info');
    await sleep(800);
    appendLog('TCP Handshake: SYN-ACK â†', 'info');
    await sleep(800);
    appendLog('TCP Handshake: ACK â†’ (Connection Established)', 'success');

    appendLog('Auth: Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ISO8583 MTI 0200', 'info');
    await sleep(1200);
    appendLog('Auth: Ø¨Ø±Ø±Ø³ÛŒ PIN Block + CVV + ExpDate', 'info');
    await sleep(1200);
    appendLog('Auth Result: Approved (RC=00)', 'success');

    const delay = Math.floor(Math.random() * 8000) + 5000;
    appendLog(`Network Delay Simulation: ${Math.floor(delay/1000)}s / ØªØ§ 13 Ø«Ø§Ù†ÛŒÙ‡`, 'warning');
    await sleep(delay);

    appendLog(`Transaction Complete | Ù…Ø¨Ù„Øº: ${amount.toLocaleString('fa-IR')} Ø±ÛŒØ§Ù„`, 'success');
    appendLog('Available Withdrawal: Û± Ù‡Ø²Ø§Ø± Ùˆ Û¸ÛµÛ° Ù…Ù„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„', 'success');
    appendLog('Blocked Amount: Û¹Û³ ØªØ±ÛŒÙ„ÛŒÙˆÙ† Ùˆ Û¸Û¹Û³ Ù…Ù„ÛŒØ§Ø±Ø¯ Ùˆ Û¶Û·Û° Ù…Ù„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„', 'warning');
  }

  function printReceipt() {
    const src = sourceCard.value || '---- ---- ---- ----';
    const dst = targetInput.value || '----';
    const owner = ownerInfo.textContent || '-';
    const toOwner = targetOwner.textContent || '-';
    const amount = Number(amountInput.value || 0).toLocaleString('fa-IR');

    const w = window.open('', '_blank', 'width=420,height=620');
    w.document.write(`
      <html lang="fa" dir="rtl"><head><title>Ø±Ø³ÛŒØ¯ ØªØ±Ø§Ú©Ù†Ø´</title></head>
      <body class="receipt">
        <h3 style="text-align:center">Ø±Ø³ÛŒØ¯ Ú©Ø§Ø±Øªâ€ŒØ¨Ù‡â€ŒÚ©Ø§Ø±Øª</h3>
        <hr>
        ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleString('fa-IR')}<br>
        Ú©Ø§Ø±Øª Ù…Ø¨Ø¯Ø§: ${src}<br>
        Ù…Ø§Ù„Ú© Ù…Ø¨Ø¯Ø§: ${owner}<br>
        Ú©Ø§Ø±Øª/Ø­Ø³Ø§Ø¨ Ù…Ù‚ØµØ¯: ${dst}<br>
        Ù…Ø§Ù„Ú© Ù…Ù‚ØµØ¯: ${toOwner}<br>
        Ù…Ø¨Ù„Øº: ${amount} Ø±ÛŒØ§Ù„<br>
        ÙˆØ¶Ø¹ÛŒØª: Ù…ÙˆÙÙ‚ (00)<br>
        Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ: ${Math.floor(Math.random()*9e11+1e11)}<br>
        <hr>
        Ù…Ø§Ù†Ø¯Ù‡ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª: Û± Ù‡Ø²Ø§Ø± Ùˆ Û¸ÛµÛ° Ù…Ù„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„<br>
        Ù…Ø¨Ù„Øº Ù…Ø³Ø¯ÙˆØ¯ÛŒ: Û¹Û³ ØªØ±ÛŒÙ„ÛŒÙˆÙ† Ùˆ Û¸Û¹Û³ Ù…Ù„ÛŒØ§Ø±Ø¯ Ùˆ Û¶Û·Û° Ù…Ù„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„
      </body></html>
    `);
    w.document.close();
    w.focus();
    w.print();
    appendLog('Receipt popup opened for print.', 'success');
  }

  function resetAll() {
    sourceCard.value = '';
    targetInput.value = '';
    amountInput.value = 12500000;
    pin = '';
    pinView.textContent = '----';
    binInfo.textContent = '-';
    ownerInfo.textContent = '-';
    targetOwner.textContent = '-';
    logEl.innerHTML = '';
    appendLog('Reset Ú©Ø§Ù…Ù„ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.', 'warning');
  }

  document.querySelectorAll('.menu button').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.menu button').forEach(x => x.classList.remove('active'));
      btn.classList.add('active');
      const m = btn.dataset.menu;
      document.getElementById('transferPane').classList.toggle('hidden', m !== 'transfer');
      document.getElementById('balancePane').classList.toggle('hidden', m !== 'balance');
      document.getElementById('identityPane').classList.toggle('hidden', m !== 'identity');
      appendLog(`Menu changed => ${m}`, 'info');
    };
  });

  document.getElementById('runBtn').onclick = runTransaction;
  document.getElementById('printBtn').onclick = printReceipt;
  document.getElementById('resetBtn').onclick = resetAll;

  buildPinpad();
  appendLog('POS Demo loaded. Ù…Ù†ØªØ¸Ø± ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Øª Û±Û¶ Ø±Ù‚Ù…ÛŒ...', 'info');
</script>
</body>
</html>
